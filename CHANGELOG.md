# 更新日志

## [1.13.0] - 2024-12-20

### 配置管理重构
- 🔧 **常量配置优化**: 将 `shared/constants.js` 重构为 `constants.json` 格式
  - 统一项目常量管理，采用JSON配置文件
  - content-script.js 使用 fetch 异步获取配置数据
  - 其他模块通过 ES6 import 按需导入JSON字段
  - 提升配置管理的一致性和可维护性

### 技术改进
- 📦 **模块加载优化**: 
  - content script 异步加载配置，避免同步导入限制
  - 其他组件直接导入JSON配置，简化依赖管理
  - 支持按需导入特定配置字段，减少内存占用
- 🏗️ **构建配置完善**: 
  - 确保 @rollup/plugin-json 插件正确配置
  - 优化 Vite 构建流程，支持JSON文件导入
  - 完善错误处理和后备配置机制
- 🔒 **安全性增强**: 
  - 添加 web_accessible_resources 配置
  - 确保配置文件安全访问和加载

### 文件变更
- ✅ 创建 `src/shared/constants.json` 统一配置文件
- ✅ 更新所有相关文件的导入方式
- ✅ 移除原有 `src/shared/constants.js` 文件
- ✅ 构建测试通过，功能正常运行

## [1.12.0] - 2024-12-20
# 更新日志

## [1.12.0] - 2024-12-20

### 优化
- 🔧 **配置管理优化**: 将常量配置从 `constants.js` 改为 `constants.json` 格式
- 📦 **模块加载优化**: content-script.js 使用 fetch 异步加载常量配置，提升加载性能
- 🏗️ **架构改进**: 其他模块通过 ES6 import 导入 JSON 配置，统一配置管理方式
- 🔒 **安全性增强**: 添加 web_accessible_resources 配置，确保配置文件安全访问
- 🚀 **性能提升**: 优化常量加载机制，减少初始化时间

### 技术改进
- 重构常量管理系统，采用 JSON 配置格式
- 优化 content script 异步加载逻辑
- 完善错误处理和后备配置机制
- 更新构建配置以支持新的模块结构

## [1.11.0] - 2024-12-20

### 代码优化
- 🔧 **常量统一管理**: 将所有常量定义统一到 `shared/constants.js` 文件中
  - 统一 `DEFAULT_LANGUAGE_PREFERENCES` 和 `DEFAULT_EXTENSION_SETTINGS` 配置
  - 统一 `SUPPORTED_LANGUAGES` 语言列表定义
  - 移除各文件中重复的常量定义，提升代码维护性

- 🌐 **语言支持简化**: 将支持的翻译语言简化为4种常用语言
  - 保留：自动检测、英语、中文、日语、韩语
  - 移除其他较少使用的语言选项，专注主要使用场景
  - 优化语言选择界面，提升用户体验

- 🛠️ **代码结构优化**: 重构项目架构，提升代码质量
  - 统一导入路径，避免重复定义
  - 优化 `TranslationCore` 类的语言列表获取方式
  - 简化语言偏好和扩展设置的默认配置
  - 提升构建效率和运行性能

### 技术改进
- 📦 **构建优化**: 优化项目构建配置，减少重复代码
- 🔍 **代码检查**: 全面检查并修复潜在的代码问题
- 📝 **文档更新**: 更新版本号和相关文档说明

## [1.10.0] - 2024-12-20

### 🎯 优化改进
- **简化语言选择**: 将支持的语言选项从15种简化为6种常用语言（自动检测、中文、英文、日语、韩语、法语）
- **优化默认设置**: 默认源语言改为英文(en)，目标语言保持中文(zh)
- **移除自动检测依赖**: 目标语言不再需要自动检测，提升翻译效率
- **精简语言对**: 常用语言对配置优化，聚焦主要翻译需求

### 🔧 技术优化
- 更新 `constants.js` 中的语言配置
- 优化 `DEFAULT_LANGUAGE_PREFERENCES` 设置
- 简化 `POPULAR_LANGUAGE_PAIRS` 配置
- 移除冗余的语言选项，提升性能

### 📝 文档更新
- 更新版本号至 1.11.0
- 完善更新日志记录

## [1.10.0] - 2024-12-20

### 🚀 重大优化
- **翻译核心重构**: 创建统一的 `TranslationCore` 类，替代原有的 `TranslatorService`
- **错误处理增强**: 添加完善的API可用性检查和用户友好的错误提示
- **语言检测优化**: 改进自动语言检测逻辑，检测失败时不设置默认语言
- **代码清理**: 删除未使用的代码和文件，提升代码质量

### ✨ 新功能
- **API可用性检查**: 自动检测 Translator API 和 LanguageDetector API 可用性
- **智能错误提示**: 
  - LanguageDetector API 不可用时提示用户升级浏览器
  - 语言检测失败时显示"语言检测失败"而非默认语言
  - 翻译失败时在译文位置显示"翻译失败"提示
- **统一错误样式**: 所有错误提示使用12px红色字体，保持界面一致性

### 🔧 技术改进
- **架构优化**: 
  - 创建 `src/shared/translation-core.js` 作为翻译功能的统一入口
  - 所有组件统一使用 `translationCore.smartTranslate()` 方法
  - 移除冗余的 `src/shared/translator.js` 文件
- **全文翻译增强**: 
  - 修复 `sourceLanguage` 为 'auto' 时的处理逻辑
  - 改进多文本片段的翻译流程和错误处理
- **组件更新**:
  - `src/popup/App.vue`: 集成translationCore，添加API可用性检查
  - `src/test/App.vue`: 同步popup界面的优化，保持功能一致性
  - `src/content/content-script.js`: 修复语法错误，优化翻译逻辑
  - `src/background/service-worker.js`: 使用translationCore进行后台翻译
  - `src/popup/components/LanguageSelector.vue`: 更新API可用性检查

### 🐛 修复问题
- 修复content-script.js中的多处语法错误（缺少分号等）
- 修复全文翻译功能在自动检测语言时的逻辑错误
- 修复语言检测失败时的错误处理流程
- 统一各组件间的错误提示样式和文案

### 📝 文档更新
- 更新版本号至 1.10.0
- 完善CHANGELOG记录重大架构变更

## [1.9.13] - 2025-01-20

### 新增
- 创建了专门的翻译核心类 `TranslationCore`，统一处理语言检测和翻译功能
- 封装了智能翻译方法 `smartTranslate`，自动处理语言检测和翻译逻辑
- 统一了右键菜单、扩展面板、划词翻译的核心翻译功能

### 修复
- 修复全文翻译功能中的语言检测问题
- 优化auto自动检测模式下的翻译逻辑
- 修复扩展面板和右键菜单的全文翻译功能
- 改进多文本片段翻译的语言检测机制
- 优化滚动翻译的语言检测处理

### 改进
- 全文翻译现在支持为每个文本片段单独检测语言
- 提升了auto模式下的翻译准确性
- 优化了翻译状态的同步机制
- 统一了test和popup界面的UI一致性
- 重构了翻译核心逻辑，提高了代码复用性

### 技术优化
- 创建了 `src/shared/translation-core.js` 核心翻译类
- 更新了所有翻译相关组件使用统一的翻译核心
- 优化了语言检测和归一化比较逻辑
- 改进了错误处理和降级机制

## [1.9.12] - 2025-01-20

### 修复
- 修复全文翻译功能中的语言检测问题
- 优化auto自动检测模式下的翻译逻辑
- 修复扩展面板和右键菜单的全文翻译功能
- 改进多文本片段翻译的语言检测机制
- 优化滚动翻译的语言检测处理

### 改进
- 全文翻译现在支持为每个文本片段单独检测语言
- 提升了auto模式下的翻译准确性
- 优化了翻译状态的同步和更新机制
- 改进了content script和background service的消息传递

### 技术优化
- 重构了handleTranslatePage方法的语言检测逻辑
- 优化了translateNewlyVisibleContent的语言处理
- 改进了右键菜单全文翻译的实现
- 统一了各组件间的语言检测处理方式

## [1.9.12] - 2025-08-20

### 全文翻译与统一策略
- 当源语言为 auto 时，先使用 LanguageDetector 检测文本语言；若与目标语言一致则直接返回原文（忽略大小写与地区码，如 zh 与 zh-CN 视为相同），否则再调用 Translator API。
- 适用入口：测试页、扩展面板“全文翻译”、右键菜单“全文翻译”。

### 划词翻译一致性
- 源=目标判定改为归一化比较，避免 zh 与 zh-CN 误判。

### 实现
- shared/translator.js：translateSmart/translateSmartStreaming 与基础 translate/translateStreaming 增加语言归一化判定。
- background/service-worker.js：TRANSLATE_TEXT 与流式翻译在 source='auto' 时先检测，并在源=目标（归一化）直接返回原文。
- content/content-script.js：划词弹窗同语种（归一化）直接展示原文。

### 版本
- 更新 package.json 与 manifest.json 版本至 1.9.12

## [1.9.11] - 2025-08-20

### 划词翻译
- 修复：当源语言为 auto 自动检测、目标语言为中文且选中文本为中文时，翻译结果弹窗显示后会立即被隐藏的问题。
- 变更：在 src/content/content-script.js 的 handleTextSelection 中，当选区为空时仅在不存在翻译弹窗的情况下才调用 hideOverlay，避免竞态误关闭。

### 稳定性
- 维持 selectionchange/scroll 等场景下存在弹窗时不自动关闭的策略。

### 版本
- 更新 package.json 与 manifest.json 版本至 1.9.11

## [1.9.10] - 2025-08-20

### 功能与复用
- 🧠 智能翻译封装：新增 translatorService.translateSmart / translateSmartStreaming
  - 当 source='auto' 时先使用 LanguageDetector 检测源语言
  - 忽略大小写比较源语言与目标语言，相同直接输出原文，不调用 Translator API
  - 流式场景相同语言返回原文的模拟流
- ♻️ 复用落地：测试页与弹窗页统一复用智能翻译封装，移除冗余的 createTranslator 调用

### 划词弹窗
- 🪟 稳定性：当检测的源语言与目标语言一致时，弹窗不自动关闭；点击弹窗自身不关闭，仍仅支持“点 × 或页面其它区域”关闭
- 🔒 防误关：修正 selectionchange / 滚动等情况下的自动关闭行为，存在弹窗时不再隐藏

### 错误修复
- 🛠️ 修复“Unable to create translator…”与重复错误提示问题
  - createTranslator 报错仅抛底层 message，避免“创建翻译器失败: 创建翻译器失败: …”重复包裹
  - 同语种短路避免尝试创建翻译器导致的错误

### 构建与日志
- 🧹 生产构建移除 content-script 等日志（esbuild drop console/debugger）
- 🤫 打包脚本默认静默，仅保留致命错误，子进程输出抑制

### 版本
- 📦 版本号更新至 1.9.10（package.json、manifest.json）

## [1.9.9] - 2025-08-20

### 细节优化
- 🧠 划词翻译：自动检测源语言；若检测成功且源语言与目标语言一致，直接返回原文，不请求翻译API
- 🪟 弹窗行为：仅点击“×”或页面其它区域时关闭；点击弹窗本身不关闭；修复 selectionchange 导致的误关闭
- 🧪 测试：测试页新增“自动检测源语言（LanguageDetector）”开关，便于验证链路

### 构建日志
- 构建脚本默认全静默：移除所有打包日志，仅保留致命错误
- 子进程输出已抑制（build、validate、analyze 等）

### 版本与文档
- 版本号更新至 1.9.9（package.json、manifest.json）
- 更新 README：补充“划词自动检测源语言”和“源=目标直接返回原文”的说明

## [1.9.8] - 2025-08-20

### 细节优化
- 🌐 划词翻译：使用 LanguageDetector 自动检测选中文本源语言；目标语言与扩展面板所选目标语言同步
- 🧷 稳定性：修复 selectionchange 导致弹窗误关闭；延迟外部点击监听至 800ms；弹窗内部事件阻止冒泡，避免误关
- 🧪 测试：测试页新增“自动检测源语言（LanguageDetector）”开关，翻译前自动检测
- 📦 版本同步：更新 package.json 与 manifest.json 至 1.9.8

## [1.9.7] - 2025-08-19

### 细节优化
- 🖱️ 划词翻译弹窗改为延迟弹出（等待翻译完成后再显示），避免“正在翻译...”闪烁
- 🔧 更新 src/content/content-script.js 的 showTranslationPopup 逻辑（先翻译，后创建弹窗）
- ✅ 回读校验修改文件，未发现语法报错
- 📦 版本号更新至 1.9.7（package.json、manifest.json 同步）

## [1.9.6] - 2025-08-19

### 重大功能改进和用户体验优化
- 🔧 **右键菜单状态修复**:
  - 修复刷新页面后右键菜单文字没有正确显示的问题
  - 添加标签页激活和更新事件监听器，自动更新右键菜单状态
  - 确保右键菜单始终显示正确的"全文翻译"或"取消全文翻译"文字

- ⚡ **划词翻译弹窗优化**:
  - 修复翻译结果弹窗的延迟弹出问题，现在立即显示加载状态
  - 优化弹窗边界检测，确保弹窗完整显示在可视区域内
  - 改进翻译图标的边界问题，防止图标超出屏幕边界
  - 添加平滑的显示和隐藏动画效果
  - 优化弹窗定位算法，智能选择最佳显示位置

- 🌍 **智能全文翻译**:
  - **可视区域优先翻译**: 全文翻译现在只翻译当前可视区域内的文本内容
  - **滚动自动翻译**: 当用户滚动页面时，新进入可视区域的文本会自动翻译
  - **避免重复翻译**: 已翻译的内容不会重复翻译，提高效率
  - **性能优化**: 减少初始翻译量，提升翻译速度和用户体验
  - **智能缓存**: 防抖处理滚动事件，避免频繁的翻译请求

- 🎯 **测试和弹窗页面同步**:
  - 测试页面和弹窗页面都支持新的智能全文翻译功能
  - 统一的可视区域检测算法和滚动翻译逻辑
  - 完善的事件监听器管理，避免内存泄漏

- 🔍 **代码质量保证**:
  - 全面检查所有修改文件，确保没有语法错误
  - 验证构建过程，确保扩展正常工作
  - 优化代码结构和错误处理机制

- 📝 **版本和文档更新**:
  - 更新版本号至1.9.6
  - 更新CHANGELOG记录所有改进内容
  - 完善功能说明和使用指南

## [1.9.5] - 2025-08-19

### 功能细节优化和修复
- 🎨 **全文翻译译文颜色修改**:
  - 全文翻译的译文颜色统一修改为#d650dc（紫色）
  - 单个翻译的译文保持原来的颜色不变
  - 添加`.translation-append`CSS类专门用于全文翻译样式

- 🔄 **页面刷新状态修复**:
  - 修复刷新页面后全文翻译状态被错误取消的问题
  - 页面加载时正确检测翻译标记，恢复翻译状态
  - 确保右键菜单状态与页面翻译状态保持同步
  - 弹窗页面初始化时自动更新右键菜单状态

- 🖱️ **划词翻译体验优化**:
  - 点击翻译图标后，翻译结果弹窗延迟弹出，等待翻译完成后再显示
  - 避免显示"正在翻译..."的加载状态，直接显示翻译结果
  - 减少外部点击监听器的延迟时间，因为翻译已经完成
  - 优化翻译弹窗的显示逻辑和用户体验

- 🔍 **代码质量检查**:
  - 全面检查并验证所有更新、修改的文件
  - 确保没有语法错误和潜在问题
  - 优化代码结构和错误处理机制

- 📝 **版本和文档更新**:
  - 更新版本号至1.9.5
  - 更新package.json和manifest.json版本信息
  - 完善更新日志，详细记录所有细节修改
  - 按倒序追加历史记录，保持时间顺序

### 技术改进
- 🛠️ **状态管理优化**:
  - 改进页面翻译状态的检测和恢复逻辑
  - 优化右键菜单状态的同步机制
  - 增强翻译状态在不同组件间的一致性

- 🎨 **UI/UX细节优化**:
  - 统一全文翻译译文的视觉表现
  - 改进划词翻译的交互流程
  - 优化翻译状态的视觉反馈

- 📡 **消息传递优化**:
  - 改进翻译完成后的状态通知机制
  - 优化弹窗页面的初始化流程
  - 增强错误处理和异常恢复能力

### 修复详情
- **颜色统一**: 全文翻译译文现在使用统一的#d650dc紫色显示
- **状态恢复**: 页面刷新后能正确检测并恢复全文翻译状态
- **交互优化**: 划词翻译弹窗等待翻译完成后再显示，提供更好的用户体验
- **同步机制**: 右键菜单状态与页面翻译状态保持实时同步

## [1.9.4] - 2025-08-19

### 样式优化和细节修复
- 🎨 **翻译文本样式统一**:
  - 创建`.translated-text`CSS类，统一翻译文本的颜色为#d650dc
  - 翻译文本字体大小跟随原文，移除背景色，避免行内样式过多
  - 应用到全文翻译、划词翻译弹窗、翻译结果组件等所有翻译文本显示

- 🔄 **全文翻译状态修复**:
  - 修复刷新页面后全文翻译状态被重置的问题
  - 页面加载时检查是否已有翻译标记，自动恢复翻译状态
  - 确保全文翻译按钮文字正确显示"取消全文翻译"或"全文翻译"

- 🖱️ **划词翻译稳定性优化**:
  - 进一步增加外部点击监听器的延迟时间，从500ms增加到1000ms
  - 添加鼠标事件的阻止冒泡处理，防止意外关闭翻译弹窗
  - 确保翻译弹窗在翻译完成后稳定显示，由用户主动关闭
  - 优化弹窗内部事件处理，提升交互稳定性

- 📝 **版本管理**:
  - 更新版本号至1.9.4
  - 更新package.json和manifest.json版本信息
  - 完善更新日志，详细记录所有样式和功能优化

### 技术改进
- 🛠️ **代码质量提升**:
  - 统一翻译文本样式管理，使用CSS类替代行内样式
  - 改进页面状态检测逻辑，确保翻译状态的准确性
  - 优化事件处理机制，提升用户交互体验
  - 全面检查并验证所有更新文件，确保无语法错误

- 🎨 **UI/UX优化**:
  - 统一所有翻译文本的视觉表现，使用一致的紫色主题
  - 改进全文翻译状态的视觉反馈
  - 提升划词翻译弹窗的稳定性和可用性
  - 优化翻译详情弹窗中译文的颜色显示

### 修复详情
- **样式统一**: 所有翻译文本现在使用统一的#d650dc颜色和继承字体大小
- **状态恢复**: 页面刷新后能正确检测并恢复全文翻译状态
- **交互稳定**: 划词翻译弹窗不再意外自动关闭，提供更好的用户体验
- **代码优化**: 使用CSS类管理样式，减少行内样式，提高代码可维护性

## [1.9.3] - 2025-08-19

### 重要修复和优化
- 🔄 **右键菜单与扩展全文翻译状态同步**:
  - 修复右键菜单和扩展面板全文翻译状态不一致的问题
  - 实现双向状态同步，在扩展面板点击全文翻译时右键菜单状态同步更新
  - 在右键菜单执行全文翻译时扩展面板状态同步更新
  - 添加background service和popup页面之间的消息传递机制
  - 确保所有翻译操作的状态保持一致

- 🖱️ **划词翻译弹窗修复**:
  - 完全修复划词翻译点击图标后弹窗显示"正在翻译..."然后马上自动关闭的问题
  - 增加外部点击监听器的延迟时间，从200ms增加到500ms，确保弹窗完全显示
  - 改进翻译请求的错误处理，确保弹窗在翻译过程中不会意外关闭
  - 优化弹窗状态检查逻辑，使用更可靠的DOM查询方式
  - 翻译图标保持5秒显示时间，点击后显示翻译弹窗由用户手动关闭

- 🌐 **全文翻译状态管理优化**:
  - 在测试页面和弹窗页面都添加翻译状态变化监听器
  - 实现页面翻译状态的实时同步和更新
  - 添加当前页面翻译状态检查功能
  - 优化翻译完成后的状态通知机制
  - 确保取消翻译时状态正确重置

- 📡 **消息传递机制增强**:
  - 新增`TRANSLATION_STATUS_CHANGED`消息类型用于状态同步
  - 新增`UPDATE_CONTEXT_MENU`消息类型用于菜单更新
  - 改进background service的消息处理逻辑
  - 添加消息传递的错误处理和异常恢复
  - 优化popup页面和content script的通信可靠性

### 技术改进
- 🛠️ **代码质量提升**:
  - 全面检查并验证所有更新文件，确保无语法错误
  - 改进事件处理和状态管理的可靠性
  - 优化异步操作的错误处理机制
  - 增强调试日志和状态追踪能力

- 🎨 **用户体验优化**:
  - 确保划词翻译弹窗的稳定显示和正确关闭
  - 统一全文翻译功能在不同入口的行为表现
  - 改进翻译状态的视觉反馈和用户提示
  - 提升翻译操作的响应速度和成功率

- 📦 **版本管理**:
  - 更新版本号至1.9.3
  - 更新package.json和manifest.json版本信息
  - 完善更新日志，详细记录所有修复内容
  - 通过构建验证，确保扩展功能正常

### 修复详情
- **状态同步**: 从右键菜单和扩展面板状态不一致，修复为完全同步的双向状态管理
- **划词翻译**: 从点击图标后立即关闭，修复为稳定显示翻译结果且由用户控制关闭
- **消息传递**: 改进background service、popup和content script之间的通信机制
- **错误处理**: 增强各种异常情况的处理和用户提示
- **状态管理**: 实现可靠的翻译状态跟踪和同步机制

## [1.9.2] - 2025-08-19

### 重要修复和优化
- 🔧 **全文翻译功能完全修复**:
  - 修复全文翻译功能中真实翻译的文本节点数量与找到的文本节点数量不一致的问题
  - 改进文本节点过滤逻辑，确保所有有意义的文本都能被翻译
  - 移除翻译数量限制，让所有找到的文本节点都能翻译
  - 添加详细的翻译进度日志和统计信息
  - 优化文本节点识别，排除扩展自身元素和无意义文本

- 🖱️ **划词翻译功能完全修复**:
  - 修复点击翻译图标后弹窗显示"正在翻译..."然后马上自动关闭的问题
  - 改进翻译弹窗的事件处理逻辑，防止意外关闭
  - 添加弹窗内部点击事件阻止冒泡，避免误触关闭
  - 延长外部点击监听器的添加时间，防止立即触发关闭
  - 增强翻译请求的错误处理和状态检查
  - 确保翻译结果正确显示，不会自动关闭

- 🌐 **右键菜单全文翻译修复**:
  - 完全修复右键菜单全文翻译功能的文本节点数量缺失问题
  - 统一content script和popup页面的全文翻译逻辑
  - 改进content script的加载检查和初始化流程
  - 添加详细的翻译进度跟踪和错误处理
  - 确保所有找到的文本节点都能被正确翻译

- 📱 **弹窗页面全文翻译优化**:
  - 修复弹窗页面全文翻译功能的消息传递问题
  - 改进content script的注入和初始化检查
  - 添加PING消息验证content script状态
  - 优化错误处理和用户反馈机制
  - 确保语言设置正确传递到content script

- 🔍 **选中文本检测优化**:
  - 改进弹窗页面的选中文本检测逻辑
  - 添加content script就绪状态检查
  - 优化自动翻译选中文本的触发机制
  - 增强错误处理和日志输出

### 技术改进
- 🛠️ **代码质量提升**:
  - 全面检查并修复所有更新文件中的潜在错误
  - 改进事件处理和消息传递的可靠性
  - 优化翻译请求的错误处理和重试机制
  - 增强调试日志和错误追踪能力

- 🎨 **用户体验优化**:
  - 改进翻译进度显示和用户反馈
  - 优化弹窗交互逻辑，避免意外关闭
  - 统一全文翻译功能的行为表现
  - 提升翻译成功率和稳定性

- 📦 **版本管理**:
  - 更新版本号至1.9.2
  - 更新package.json和manifest.json版本信息
  - 完善更新日志，详细记录所有修复内容
  - 确保所有功能正常工作和测试通过

### 修复详情
- **全文翻译**: 从找到36个节点只翻译30个，修复为找到多少个就翻译多少个
- **划词翻译**: 从点击图标后立即关闭，修复为正常显示翻译结果且由用户控制关闭
- **右键菜单**: 从翻译节点数量不足，修复为与弹窗页面完全一致的翻译效果
- **消息传递**: 改进content script加载检查和消息路由机制
- **错误处理**: 增强各种异常情况的处理和用户提示

## [1.9.1] - 2025-08-19

### 重要修复和优化
- 🔧 **应用加载状态优化**:
  - 移除`.extension-popup:not(.app-ready)`类似的CSS样式
  - 将扩展初始化的loading状态移动到.app容器中处理
  - 扩展加载完成后直接替换loading状态，无需手动调整
  - 优化测试页面和弹窗页面的加载体验

- 🖱️ **划词翻译功能修复**:
  - 修复点击图标弹窗显示翻译失败并马上关闭的问题
  - 现在能正确翻译选中的文本，不会自动关闭
  - 改进选中文本的获取和传递机制
  - 优化翻译弹窗的显示逻辑和用户体验

- 🌐 **右键菜单全文翻译修复**:
  - 完全重构右键菜单全文翻译逻辑
  - 修复点击全文翻译只显示"页面翻译完成，共翻译了 0 个文本片段"的问题
  - 确保content script正确加载和初始化
  - 添加详细的调试日志和错误处理
  - 改进翻译请求的可靠性和成功率

- 🔍 **代码质量检查**:
  - 全面检查并修复所有更新文件中的潜在错误
  - 验证构建系统正常工作
  - 确保扩展功能完整性和稳定性

- 📦 **版本管理**:
  - 更新版本号至1.9.1
  - 更新package.json和manifest.json版本信息
  - 完善更新日志，详细记录所有修复内容

### 技术改进
- 🛠️ **应用架构优化**:
  - 改进应用初始化流程，统一加载状态管理
  - 优化Vue组件的生命周期处理
  - 增强错误处理和异常恢复机制

- 🎨 **UI/UX改进**:
  - 统一加载状态的视觉表现
  - 改进翻译弹窗的交互逻辑
  - 优化全文翻译的用户反馈

- 📡 **消息传递优化**:
  - 改进content script和background service之间的通信
  - 增强消息处理的可靠性和错误恢复
  - 优化翻译请求的路由和处理逻辑

## [1.9.0] - 2025-08-19

### 重要修复和优化
- 🔧 **弹窗页面显示修复**:
  - 修复popup扩展的翻译tab页面内容空白显示问题
  - 恢复popup.html中被移除的关键CSS样式
  - 优化Vite构建配置，确保样式正确保留
  - 调整弹窗宽度为420px，改善显示效果

- 🖱️ **划词翻译功能完善**:
  - 修复划词翻译弹窗自动关闭的问题，现在由用户手动关闭
  - 改进翻译弹窗的定位逻辑，避免超出屏幕边界
  - 增强翻译弹窗的样式和交互体验
  - 添加HTML转义处理，确保文本安全显示
  - 优化外部点击关闭逻辑，避免立即触发

- 🌐 **右键菜单全文翻译修复**:
  - 完全重构右键菜单全文翻译逻辑
  - 确保content script正确加载和初始化
  - 添加PING消息处理，验证content script状态
  - 改进翻译进度显示，包含进度条和动画效果
  - 限制翻译数量为30个文本片段，避免过多请求
  - 添加翻译间隔延迟，防止API请求过于频繁

- 📊 **翻译进度优化**:
  - 新增带进度条的翻译进度指示器
  - 实时显示翻译进度和当前处理的文本片段
  - 添加进度动画效果，提升用户体验
  - 优化进度提示的样式和布局

### 技术改进
- 🛠️ **代码质量提升**:
  - 全面检查并修复所有更新文件中的潜在错误
  - 改进错误处理和异常捕获机制
  - 优化组件间的消息传递和状态同步
  - 增强翻译请求的可靠性和稳定性

- 🎨 **UI/UX优化**:
  - 修复弹窗页面的样式显示问题
  - 改进翻译弹窗的交互逻辑和视觉效果
  - 优化全文翻译的进度显示和用户反馈
  - 统一各组件的样式风格和交互行为

- 📦 **构建系统优化**:
  - 修复Vite配置中样式被错误移除的问题
  - 确保关键CSS样式在构建后正确保留
  - 优化扩展构建流程和文件处理逻辑

- 🔍 **版本管理**:
  - 更新版本号至1.9.0
  - 更新package.json和manifest.json版本信息
  - 完善更新日志，详细记录所有修复和改进内容

## [1.8.0] - 2025-08-19

### 重要修复和优化
- 🔧 **划词翻译修复**:
  - 修复划词翻译图标弹窗自动关闭的问题，现在只有用户点击空白处才会关闭
  - 修复点击翻译图标后显示"翻译失败"的问题，改进翻译请求处理逻辑
  - 移除翻译图标的3秒自动隐藏功能，提升用户体验

- 🌐 **全文翻译功能完善**:
  - 修复全文翻译按钮文字显示问题，确保右侧显示正确的目标语言
  - 统一全文翻译按钮和右键菜单的翻译逻辑，使用相同的语言设置
  - 改进右键菜单全文翻译功能，传递正确的源语言和目标语言参数

- 🖱️ **右键菜单优化**:
  - 确保右键菜单的全文翻译逻辑与扩展弹窗中的全文翻译按钮完全一致
  - 改进语言偏好的获取和传递机制
  - 优化翻译状态的跟踪和菜单文字更新

- 🎨 **测试页面修复**:
  - 检查并修复测试页面翻译tab内容显示问题
  - 确保所有组件正常加载和渲染
  - 优化CSS样式和布局问题

### 技术改进
- 🛠️ **代码质量提升**:
  - 全面检查并修复所有更新文件中的潜在错误
  - 改进错误处理和异常捕获机制
  - 优化组件间的消息传递和状态同步

- 📦 **版本管理**:
  - 更新版本号至1.8.0
  - 更新package.json和manifest.json版本信息
  - 完善更新日志，详细记录所有修复内容

- 🔍 **用户体验优化**:
  - 改进翻译弹窗的交互逻辑，避免意外关闭
  - 统一全文翻译功能的行为表现
  - 优化语言设置的传递和使用

## [1.7.0] - 2025-08-19

### 功能修复和UI优化
- 🔧 **翻译结果优化**:
  - 移除翻译结果中的"保存"按钮，翻译会自动保存到历史记录
  - 简化用户操作流程，避免重复保存

- 🎨 **全文翻译UI修复**:
  - 修复全文翻译按钮鼠标悬停时背景和文字颜色不可见的问题
  - 优化按钮悬停状态，确保良好的视觉反馈

- 🌐 **全文翻译功能增强**:
  - 修复全文翻译功能，正确根据目标语言进行翻译
  - 改进翻译状态跟踪和错误处理
  - 优化翻译进度显示和用户反馈

- 🖱️ **划词翻译修复**:
  - 修复划词翻译点击图标后显示翻译失败的问题
  - 改进翻译请求的错误处理和重试机制
  - 移除自动关闭功能，由用户手动关闭翻译弹窗

- 📋 **右键菜单优化**:
  - 简化右键菜单结构，直接显示"全文翻译"或"取消全文翻译"
  - 移除二级菜单，提供更直观的用户体验
  - 实现动态菜单文字切换，根据页面翻译状态显示对应选项

- 🔍 **翻译状态管理**:
  - 添加页面翻译状态跟踪功能
  - 实现右键菜单文字的动态更新
  - 优化翻译和取消翻译的状态同步

### 技术改进
- 🛠️ **代码质量**:
  - 检查并修复所有更新文件的潜在错误
  - 优化错误处理和异常捕获机制
  - 改进组件间的消息传递和状态管理

- 📦 **版本管理**:
  - 更新版本号至1.7.0
  - 更新package.json和manifest.json版本信息
  - 完善更新日志，记录所有功能改进

## [1.6.3] - 2025-08-19

### UI优化和代码改进
- 🎨 **CSS样式优化**:
  - 去除所有组件中的max-*/min-*CSS属性，使用固定尺寸
  - 移除扩展最外层的border样式，简化界面
  - 优化全文翻译按钮外侧UI，移除不必要的背景和边框

- 🔧 **语言检测修复**:
  - 修复源语言设置为"auto"时翻译器创建失败的问题
  - 正确使用LanguageDetector API，取结果数组第一个值的detectedLanguage属性
  - 改进自动语言检测的错误处理和降级逻辑

- 📝 **代码质量**:
  - 检查并修复所有更新文件的语法错误
  - 优化组件样式的一致性和可维护性
  - 更新版本号和相关文档

## [1.6.2] - 2025-08-19

### 问题修复和优化
- 🐛 **加载状态修复**:
  - 修复扩展加载完成后"正在加载扩展..."提示状态仍显示的问题
  - 在应用就绪后显式隐藏加载指示器

- 🎨 **UI界面优化**:
  - 移除全文翻译按钮的外侧背景和虚线边框
  - 去除扩展最外层的height: 100%样式，改善布局
  - 优化全文翻译按钮样式，使用更简洁的设计

- 🔧 **语言检测改进**:
  - 优化源语言自动检测功能，增强错误处理
  - 改进LanguageDetector API的调用逻辑
  - 添加语言检测失败时的降级处理

- 📝 **代码质量**:
  - 修复Vue组件中未使用变量的警告
  - 优化翻译器服务的错误处理逻辑
  - 改进代码可读性和维护性

## [1.6.1] - 2025-08-19

### UI优化和问题修复
- 🎨 **UI界面优化**:
  - 修复扩展加载完成后"正在加载扩展..."提示状态仍显示的问题
  - 移除全文翻译按钮的背景和虚线边框，采用更简洁的设计
  - 去除扩展最外层的border和overflow CSS属性

- 🔧 **功能修复**:
  - 优化源语言自动检测功能，统一使用LanguageDetector API
  - 修复content-script.js的模块加载问题
  - 改进翻译器创建逻辑，确保自动检测语言正确传递

- 📝 **代码优化**:
  - 简化语言检测逻辑，移除重复代码
  - 统一翻译器创建接口，支持文本检测参数
  - 优化应用就绪状态管理

## [1.6.0] - 2025-08-19

### 功能优化和修复
- 🎨 **UI样式优化**: 移除CSS响应式设计，固定420px宽度和100%高度
  - 去除CSS阴影效果，采用更简洁的设计风格
  - 移除max-*和min-*的宽度、高度限制
  - 优化翻译结果样式，移除斜体显示

- 🌐 **自动语言检测**: 集成Chrome LanguageDetector API
  - 源语言选择"auto"时自动检测文本语言
  - 在测试页面、弹窗页面和后台服务中统一实现语言检测
  - 提供检测失败时的降级处理机制

- 🔧 **翻译功能修复**: 修复"auto"语言标签导致的翻译器创建失败
  - 在创建翻译器前先进行语言检测
  - 统一处理自动语言检测逻辑
  - 修复后台服务中的语言对缓存键生成

- 📱 **全文翻译优化**: 改进全文翻译按钮UI和交互
  - 按钮显示目标语言名称
  - 点击后切换为"取消全文翻译"状态
  - 优化描述文字和用户体验

- 🖱️ **右键菜单简化**: 仅保留"全文翻译"和"取消翻译"选项
  - 移除多余的右键菜单项
  - 专注于核心翻译功能

- 🎯 **文本选择翻译**: 实现用户选中文本时的实时翻译图标
  - 鼠标附近弹出翻译图标
  - 点击图标显示翻译弹窗
  - 可关闭的翻译结果显示

- 🔨 **构建系统修复**: 修复content-script.js的模块导入问题
  - 调整Vite配置，确保content-script正确构建为IIFE格式
  - 修复Chrome扩展中的ES模块兼容性问题

- 📁 **目录结构优化**: 使用dist目录作为最终扩展文件
  - 移除extension-build目录的重复构建
  - 简化构建流程和文件管理

## [1.5.0] - 2025-08-19

### 构建优化
- 🔧 **扩展加载修复**: 修复导入扩展时"清单文件缺失或不可读取"的错误
  - 优化Vite构建配置，确保manifest.json正确生成
  - 修复Chrome扩展插件的异步处理问题
  - 完善文件路径处理和资源复制逻辑

- 📦 **一键构建系统**: 新增`npm run build:complete`命令
  - 自动完成清理、构建、验证、打包全流程
  - 创建独立的extension-build目录，包含所有必需文件
  - 自动同步package.json和manifest.json版本号
  - 生成详细的构建报告和大小统计

- 🧹 **项目精简**: 移除不必要的文件，精简目录结构
  - 删除示例文件、测试文档和演示代码
  - 清理构建输出中的临时文件和文档
  - 移除重复的脚本和配置文件
  - 优化项目结构，提高维护性

- 📊 **构建验证**: 完善构建质量检查
  - 自动验证所有必需文件存在
  - 检查扩展配置的完整性和正确性
  - 生成构建报告，包含文件清单和大小信息
  - 提供详细的安装指导

### 技术改进
- 🚀 **跨平台兼容**: 构建脚本支持Windows/Linux/macOS
  - 使用Node.js原生API替代系统命令
  - 实现跨平台的文件复制和目录操作
  - 优化错误处理和异常恢复机制

- 📝 **文档更新**: 更新项目文档和说明
  - 更新README.md，添加新的构建命令说明
  - 更新BUILD.md，详细说明构建流程
  - 简化安装步骤，提供两种安装方式
  - 更新版本信息和功能特性描述

### 版本信息
- 📦 **版本号更新**: 从1.4.0升级到1.5.0
- 🏷️ **自动版本同步**: 构建时自动更新扩展版本号
- 📋 **构建报告**: 扩展大小约0.19MB，包含27个文件

## [1.4.0] - 2024-12-19

### 新增功能
- 🚫 **历史记录交互优化**: 取消历史记录项的点击事件，不再跳转到翻译标签页
  - 移除历史记录项的点击跳转功能
  - 保持历史记录的纯展示作用
  - 用户需要重新翻译时可手动输入文本

- 🌐 **全文翻译功能**: 新增翻译整个页面的功能
  - 在测试页面和弹窗页面都添加"翻译全文"按钮
  - 自动识别页面中的文本节点进行翻译
  - 在原文右侧追加译文显示，使用蓝色斜体样式
  - 限制翻译数量避免过多API请求

- 🖱️ **右键菜单集成**: 完善右键菜单功能
  - 支持"翻译选中文本"快速翻译
  - 支持"翻译此页面"全文翻译
  - 支持"快速翻译到中文/英文"
  - 支持"打开翻译面板"

- 💬 **划词翻译增强**: 改进选中文本的翻译体验
  - 在鼠标位置附近弹出翻译结果
  - 显示原文和译文的对比
  - 自动隐藏和手动关闭功能
  - 优化弹窗定位和样式

- 🎛️ **翻译面板**: 新增独立的翻译面板界面
  - 通过右键菜单或扩展图标打开
  - 提供完整的翻译输入和结果显示
  - 支持语言选择和结果复制
  - 居中显示，支持拖拽和关闭

### 技术改进
- 🔧 **Content Script增强**: 扩展内容脚本功能
  - 添加页面文本节点识别和翻译
  - 实现翻译结果的DOM注入
  - 优化事件处理和消息传递
  - 添加进度提示和错误处理

- 📡 **Background Service优化**: 完善后台服务功能
  - 改进右键菜单的创建和处理
  - 优化翻译请求的路由和处理
  - 增强消息传递的可靠性
  - 添加翻译器实例的缓存管理

- 🎨 **UI/UX改进**: 提升用户界面和体验
  - 统一弹窗和提示的样式设计
  - 优化按钮状态和加载指示
  - 改进错误提示和成功反馈
  - 增强响应式布局适配

### 版本信息
- 📦 **版本号更新**: 从1.3.0升级到1.4.0
- 📝 **文档更新**: 更新README.md和相关说明文档
- 🏷️ **Manifest更新**: 更新扩展配置文件版本信息

## [1.3.0] - 2024-12-19

### 新增功能
- ✨ **翻译历史详情弹窗**: 为每个历史记录项添加详情按钮
  - 上下布局显示完整的原文和译文
  - 中间虚线分隔，清晰区分原文和译文
  - 顶部提供复制原文和复制译文按钮
  - 支持点击右上角×或遮罩层关闭弹窗

### 功能优化
- 🚀 **智能历史记录**: 缓存命中时不重复保存到历史记录
  - 避免相同翻译内容的重复记录
  - 保持历史记录的简洁性和实用性
- 💡 **交互体验优化**: 改进历史记录列表的布局和交互
  - 历史记录项增加详情按钮
  - 优化点击区域和按钮布局
  - 提升用户操作的便利性

### 技术改进
- 🎨 **组件化设计**: 新增TranslationDetail.vue详情弹窗组件
- 📱 **响应式布局**: 详情弹窗适配不同屏幕尺寸
- 🔧 **代码优化**: 改进事件处理和状态管理

## [1.2.0] - 2024-12-19

### 新增功能
- ✨ **翻译缓存功能**: 实现基于Vue computed的内存缓存系统
  - 使用Map数据结构存储翻译结果
  - 自动检查缓存，避免重复API调用
  - 组件销毁时自动清理缓存
  - 支持基于文本内容和语言对的智能缓存键生成

### 技术改进
- 🚀 **性能优化**: 短时间内重复翻译相同内容时响应速度显著提升
- 💾 **内存管理**: 采用会话级缓存，无需复杂的持久化管理
- 🔍 **调试支持**: 添加缓存操作的控制台日志输出

### 实现细节
- 在测试页面(`src/test/App.vue`)中实现完整缓存功能
- 在弹窗页面(`src/popup/App.vue`)中实现相同的缓存逻辑
- 使用Vue 3 Composition API的computed特性实现响应式缓存检查
- 缓存键格式: `${文本内容}|${源语言}|${目标语言}`

### 文档更新
- 📝 更新需求文档，简化缓存需求描述
- 📝 更新设计文档，采用computed缓存方案
- 📝 更新任务文档，去掉复杂的缓存管理任务
- 📝 新增缓存实现说明文档

## [1.1.1] - 2024-12-18

### 功能完善
- 🎯 完善翻译功能的错误处理
- 🔧 优化用户界面和交互体验
- 📱 改进响应式设计

## [1.1.0] - 2024-12-17

### 核心功能
- 🌐 实现Chrome内置Translator API集成
- 🔄 支持流式翻译功能
- 📚 添加翻译历史记录
- 🎨 实现Element Plus风格的UI设计
- 🌍 支持多语言翻译对

## [1.0.0] - 2024-12-16

### 初始版本
- 🎉 项目初始化
- ⚙️ 基础架构搭建
- 🏗️ Vite + Vue 3 开发环境配置
- 📦 Chrome扩展Manifest V3配置